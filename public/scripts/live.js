// Generated by CoffeeScript 1.7.1
var __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

(function() {
  var GET_USER_MEDIA, PeerConnection, PeerVideo, SRC_OBJECT, SessionDescription, v;
  PeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;
  SessionDescription = window.RTCSessionDescription || window.mozRTCSessionDescription || window.webkitRTCSessionDescription;
  if (navigator.getUserMedia) {
    GET_USER_MEDIA = 'getUserMedia';
  } else if (navigator.mozGetUserMedia) {
    GET_USER_MEDIA = 'mozGetUserMedia';
  } else if (navigator.webkitGetUserMedia) {
    GET_USER_MEDIA = 'webkitGetUserMedia';
  } else {
    GET_USER_MEDIA = 'getUserMedia';
  }
  v = document.createElement('video');
  if (__indexOf.call(v, 'srcObject') >= 0) {
    SRC_OBJECT = 'srcObject';
  } else if (__indexOf.call(v, 'mozSrcObject') >= 0) {
    SRC_OBJECT = 'mozSrcObject';
  } else if (__indexOf.call(v, 'webkitSrcObject') >= 0) {
    SRC_OBJECT = 'webkitSrcObject';
  } else {
    SRC_OBJECT = 'srcObject';
  }
  PeerVideo = (function() {
    function PeerVideo(config) {
      var self;
      self = this;
      config = {
        iceServers: [
          {
            url: "stun:stun.l.google.com:19302"
          }
        ]
      };
      this.pc = new PeerConnection(config);
      self.pc.onaddstream = function(obj) {
        self.domElement = document.createElement('video');
        return self.domElement.src = window.URL.createObjectURL(obj.stream);
      };
      if (config.isPublisher != null) {
        navigator[GET_USER_MEDIA]({
          video: true
        }, function(stream) {
          self.pc.onaddstream({
            stream: stream
          });
          self.pc.addStream(stream);
          return self.pc.createOffer(function(offer) {
            return self.pc.setLocalDescription(new RTCSessionDescription(offer), (function() {
              return console.log(offer);
            }), self.error);
          }, self.error);
        });
      }
    }

    PeerVideo.prototype.setOffer = function(offer) {
      var self;
      this.offer = offer;
      self = this;
      return this.pc.setRemoteDescription(new RTCSessionDescription(this.offer), function() {
        return self.pc.createAnswer(function(answer) {
          return self.pc.setLocalDescription(new RTCSessionDescription(offer), (function() {}), self.error);
        }, self.error);
      }, self.error);
    };

    PeerVideo.prototype.play = function() {
      this.domElement.play();
      if (this.onplay != null) {
        return this.onplay(this);
      }
    };

    PeerVideo.prototype.pause = function() {
      this.domElement.pause();
      this.pc.close();
      if (this.onpause != null) {
        return this.onpause(this);
      }
    };

    return PeerVideo;

  })();
  return window.PeerVideo = PeerVideo;
})();
